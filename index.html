<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FC Persona of the Day</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: rgba(12,16,28,0.65);
      --line: rgba(131, 160, 255, 0.2);
      --accent: #9bc7ff;
      --text: #e8eeff;
      --muted: #8f9acb;
    }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:22px 14px 80px;
    }
    .app{
      width:min(430px, 100%);
      background:var(--card);
      border:1px solid rgba(155,199,255,0.08);
      border-radius:20px;
      box-shadow:0 16px 55px rgba(0,0,0,0.3);
      padding:18px 18px 16px;
      position:relative;
      overflow:hidden;
    }
    .app::before{
      content:"";
      position:absolute;
      inset:-80px -10px auto auto;
      width:220px;
      height:220px;
      border:1px solid rgba(129,209,255,0.25);
      border-radius:9999px;
      filter:drop-shadow(0 0 22px rgba(129,209,255,0.35));
      pointer-events:none;
    }
    h1{
      font-size:16px;
      margin:0 0 4px;
      letter-spacing:0.03em;
    }
    p.sub{
      margin:0 0 14px;
      font-size:13px;
      color:var(--muted);
    }
    .persona-box{
      background:rgba(4,6,10,0.45);
      border:1px solid rgba(155,199,255,0.05);
      border-radius:14px;
      padding:14px 14px 12px;
      margin-bottom:14px;
    }
    .label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.08em;
      color:var(--muted);
      margin-bottom:5px;
    }
    .persona-text{
      font-size:17px;
      line-height:1.4;
    }
    .username{
      font-size:13px;
      color:var(--muted);
      margin-top:3px;
    }
    .btn-row{
      display:flex;
      gap:8px;
      margin-top:10px;
    }
    button{
      border:none;
      background:#3f5cfa;
      color:white;
      padding:9px 14px;
      border-radius:12px;
      font-weight:500;
      font-size:14px;
      cursor:pointer;
      flex:1;
    }
    button.secondary{
      background:rgba(16,22,42,0.3);
      border:1px solid rgba(155,199,255,0.14);
      color:var(--text);
      flex:0 0 auto;
      min-width:90px;
    }
    .status{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      min-height:14px;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Farcaster persona</h1>
    <p class="sub">One-line ‚Äúwho you are today‚Äù for casts.</p>

    <div class="persona-box">
      <div class="label">Today you are</div>
      <div id="persona" class="persona-text">
        Loading your vibe‚Ä¶
      </div>
      <div id="who" class="username"></div>
    </div>

    <div class="btn-row">
      <button id="regenerate" class="secondary">New vibe</button>
      <button id="share">Share</button>
    </div>

    <div id="status" class="status"></div>
  </div>

  <script type="module">
    import { sdk } from "https://esm.sh/@farcaster/miniapp-sdk";

    // tell Farcaster we're ready
    try { sdk?.actions?.ready?.(); } catch {}

    const personaEl = document.getElementById("persona");
    const whoEl = document.getElementById("who");
    const statusEl = document.getElementById("status");
    const regenBtn = document.getElementById("regenerate");
    const shareBtn = document.getElementById("share");

    // our small list of vibes
    const VIBES = [
      "üíú Meme Crafter",
      "üß™ Experiment Hunter",
      "üßµ Thread Starter",
      "ü¶´ Builder on Base",
      "üì° Channel Explorer",
      "üü£ FC Storyteller",
      "ü§ù Collab Friendly",
      "üå± Community Nurturer",
      "üî• Daily Caster",
      "üéØ Signal over Noise"
    ];

    let currentUser = null;
    let currentVibe = null;

    function pickVibe(seed = 0) {
      // simple pseudo-random by seed (fid)
      const idx = seed ? seed % VIBES.length : Math.floor(Math.random() * VIBES.length);
      return VIBES[idx];
    }

    async function init() {
      statusEl.textContent = "Fetching your Farcaster profile‚Ä¶";
      try {
        const u = await sdk.user.get();
        currentUser = u;
        const handle = u?.username ? `@${u.username}` : (u?.displayName || "");
        whoEl.textContent = handle;
        currentVibe = pickVibe(u?.fid ?? 0);
        personaEl.textContent = currentVibe;
        statusEl.textContent = "";
      } catch (e) {
        console.log(e);
        personaEl.textContent = "Mini app can‚Äôt read user here.";
        statusEl.textContent = "Open this mini app from Farcaster.";
      }
    }

    regenBtn.addEventListener("click", () => {
      // if we have fid, rotate by +1 so –æ–Ω–æ –º–µ–Ω—è–ª–æ—Å—å
      if (currentUser?.fid) {
        const fid = currentUser.fid;
        // next vibe
        const idx = (fid + Math.floor(Math.random() * 4) + Date.now()) % VIBES.length;
        currentVibe = VIBES[Math.abs(idx)];
      } else {
        currentVibe = pickVibe();
      }
      personaEl.textContent = currentVibe;
    });

    shareBtn.addEventListener("click", async () => {
      const handle = currentUser?.username ? `@${currentUser.username}` : "I";
      const text = `${handle} today is ${currentVibe || "üü£ Farcaster citizen"}.

Try it: https://neon-tap-shooter.vercel.app`;
      try {
        if (!sdk?.actions?.composeCast) {
          statusEl.textContent = "Share is only available inside Farcaster.";
          return;
        }
        await sdk.actions.composeCast({
          text,
          // –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥—ë—Ä–Ω–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É
          embeds: ["https://neon-tap-shooter.vercel.app/og.png?v=3"]
        });
        statusEl.textContent = "Cast composer opened ‚úÖ";
      } catch (e) {
        console.log(e);
        statusEl.textContent = "Could not open cast composer.";
      }
    });

    init();
  </script>
</body>
</html>
