<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Farcaster Persona</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: rgba(12,16,28,0.65);
      --text: #e8eeff;
      --muted: #8f9acb;
      --accent: #3f5cfa;
    }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:22px 14px 80px;
    }
    .app{
      width:min(430px,100%);
      background:var(--card);
      border:1px solid rgba(155,199,255,0.08);
      border-radius:20px;
      box-shadow:0 16px 55px rgba(0,0,0,0.3);
      padding:18px 18px 16px;
      position:relative;
      overflow:hidden;
    }
    h1{font-size:16px;margin:0 0 4px;}
    p.sub{margin:0 0 14px;font-size:13px;color:var(--muted);}
    .persona-box{
      background:rgba(4,6,10,0.45);
      border:1px solid rgba(155,199,255,0.05);
      border-radius:14px;
      padding:14px 14px 12px;
      margin-bottom:14px;
    }
    .label{font-size:11px;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted);margin-bottom:5px;}
    .persona-text{font-size:17px;line-height:1.4;}
    .username{font-size:13px;color:var(--muted);margin-top:3px;}
    .field{
      margin-bottom:10px;
      display:none;
    }
    .field label{
      display:block;
      font-size:12px;
      margin-bottom:4px;
      color:var(--muted);
    }
    .field input{
      width:100%;
      border:1px solid rgba(155,199,255,0.14);
      background:rgba(2,3,6,0.3);
      border-radius:10px;
      padding:7px 10px;
      color:var(--text);
    }
    .btn-row{display:flex;gap:8px;margin-top:10px;}
    button{
      border:none;
      background:var(--accent);
      color:white;
      padding:9px 14px;
      border-radius:12px;
      font-weight:500;
      font-size:14px;
      cursor:pointer;
      flex:1;
    }
    button.secondary{
      background:rgba(16,22,42,0.35);
      border:1px solid rgba(155,199,255,0.14);
      color:var(--text);
      flex:0 0 auto;
      min-width:95px;
    }
    .status{margin-top:10px;font-size:12px;color:var(--muted);min-height:14px;}
  </style>
</head>
<body>
  <div class="app">
    <h1>Farcaster persona</h1>
    <p class="sub">One-line ‚Äúwho you are today‚Äù for casts.</p>

    <div class="persona-box">
      <div class="label">Today you are</div>
      <div id="persona" class="persona-text">Loading‚Ä¶</div>
      <div id="who" class="username"></div>
    </div>

    <!-- —ç—Ç–æ –ø–æ–ª–µ –≤–∏–¥–Ω–æ, –µ—Å–ª–∏ sdk –Ω–µ –¥–∞–ª –Ω–∞–º —é–∑–µ—Ä–∞ -->
    <div id="nameField" class="field">
      <label for="nameInput">Your handle (e.g. @inna)</label>
      <input id="nameInput" type="text" placeholder="@yourname" />
    </div>

    <div class="btn-row">
      <button id="regen" class="secondary">New vibe</button>
      <button id="share">Share</button>
    </div>

    <div id="status" class="status"></div>
  </div>

  <script type="module">
    import { sdk } from "https://esm.sh/@farcaster/miniapp-sdk";
    try { sdk?.actions?.ready?.(); } catch {}

    const VIBES = [
      "üíú Meme Crafter",
      "üß™ Experiment Hunter",
      "ü¶´ Builder on Base",
      "üü£ FC Storyteller",
      "üì° Channel Explorer",
      "üî• Daily Caster",
      "üéØ Signal over Noise",
      "ü§ù Collab Friendly",
      "üßµ Thread Starter"
    ];

    const personaEl = document.getElementById("persona");
    const whoEl = document.getElementById("who");
    const statusEl = document.getElementById("status");
    const nameField = document.getElementById("nameField");
    const nameInput = document.getElementById("nameInput");
    const regenBtn = document.getElementById("regen");
    const shareBtn = document.getElementById("share");

    let currentUser = null;
    let currentVibe = VIBES[0];

    function pickVibe(seed = 0){
      const idx = seed ? seed % VIBES.length : Math.floor(Math.random() * VIBES.length);
      return VIBES[idx];
    }

    async function init(){
      statusEl.textContent = "Trying to read Farcaster user‚Ä¶";
      try {
        const u = await sdk.user.get();
        currentUser = u;
        currentVibe = pickVibe(u?.fid ?? 0);
        personaEl.textContent = currentVibe;
        whoEl.textContent = u?.username ? `@${u.username}` : (u?.displayName || "");
        statusEl.textContent = "";
      } catch(e){
        // –ù–ï –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ
        currentUser = null;
        currentVibe = pickVibe();
        personaEl.textContent = currentVibe;
        nameField.style.display = "block";
        statusEl.textContent = "Enter your handle and share.";
      }
    }

    regenBtn.addEventListener("click", () => {
      currentVibe = pickVibe(Math.floor(Math.random()*9999));
      personaEl.textContent = currentVibe;
    });

    shareBtn.addEventListener("click", async () => {
      // –±–µ—Ä—ë–º —Ö—ç–Ω–¥–ª: –ª–∏–±–æ –∏–∑ sdk, –ª–∏–±–æ –∏–∑ –ø–æ–ª—è
      let handle = "";
      if (currentUser?.username) {
        handle = `@${currentUser.username}`;
      } else if (nameInput.value.trim().length > 0) {
        handle = nameInput.value.trim();
      } else {
        handle = "I";
      }

      const text = `${handle} today is ${currentVibe}.`;

      try {
        if (!sdk?.actions?.composeCast) {
          statusEl.textContent = "Share works only inside Farcaster.";
          return;
        }
        await sdk.actions.composeCast({
          text,
          embeds: ["https://neon-tap-shooter.vercel.app/og.png?v=3"]
        });
        statusEl.textContent = "Cast composer opened ‚úÖ";
      } catch (e) {
        console.log(e);
        statusEl.textContent = "Could not open share window.";
      }
    });

    init();
  </script>
</body>
</html>
